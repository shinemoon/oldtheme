<!DOCTYPE html>
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<title>从Verilog到VHDL(下):Verification using SV </title>

<style>
	body { 
		margin-left:auto;margin-right:auto;width:860px;
		font-family:Georgia,"Times New Roman",Times,"Songti SC","SimSun",serif,"宋体";
		font-size:18px;
	}
	img {
		max-width:100%;
		margin-left:auto;margin-right:auto;
	}
</style>
</head>
<body>

<h1 style="margin-bottom:40px;"> 从Verilog到VHDL(下):Verification using SV </h1>


现在开始我们假设要在Cadence的NC工具下，对一个VHDL的设计进行验证，那么就这样按部就班的一步步探索吧。<br /><h2>RTL编译和仿真</h2><br />对于Cadence的工具来说，为人熟知的几个步骤就是ncvhdl, ncelab和ncsim。<br /><br />ncvhdl是分析VHDL代码的句法和语义，如果没有错误的话，会生成HDL设计模块的内部表述，并且放置在指定的Library当中；<br /><br />ncvlog是用于Verilog的编译指令，使用-sv可以编译SystemVerilog 文件。<br /><br />ncelab则是独立于语言的工具（verilog或者VHDL进经过前一步之后，都被转化成同意的内部表述），它负责整个结构树的生成、连接、初值计算等等。关于前文提到的一些配置和entity的对应也应当是在这一步绑定的。经过这一步，生成的snapshot就被存放在database文件中了。<br /><br />ncsim则很好理解，利用前面生成的目标文件进行仿真。<br /><br />对于这几个命令的详细信息，可以参看ius的帮助文档，有非常详尽的说明。<br /><br />对于我们想要进行的混合仿真来说，实际上思路很清晰，无<strong>非是对不同语言的文件用各自的语言编译器来编译，然后用独立于语言的ncelab来elaborate，最后进行仿真</strong>。这一点无论是哪一家Vendor都是殊途同归的。当然，要混仿，一般EDA TOOL都会要求编码时，需要满足一定的rules。而利用SystemVerilog构造顶层Testbench来包住VHDL的DUT，进行测试，是我们的目的。<br /><h2>Verification Keys</h2><br />所谓验证语言的基本问题，在我看来无非就是验证环境如何与RTL代码之间实现互动？包括信号驱动、检测，包括Scope问题。<br /><br />那么假设我们已经将VHDL的简单模块dut放置在了一个top的SystemVerilog的环境当中，那么如何回答上面的问题？<br /><br />简单的演示如下：<br /><br />vhdl的dut代码：（top.vhdl)<br /><blockquote>1 entity  top_vhdl is<br />2     port (<br />3             dut_a: out bit_vector (3 downto 0)<br />4          );<br />5 end ;<br />6 architecture    u_top   of top_vhdl is<br />7     signal reg_a: bit_vector (3 downto 0);<br />8 begin<br />9     _process: process<br />10     begin<br />11         dut_a   &lt;= "1100";<br />12         wait for 10 ns;<br />13         dut_a   &lt;= "1101";<br />14         wait for 10 ns;<br />15         dut_a   &lt;= "0011";<br />16         reg_a   &lt;=  not reg_a;<br />17         --assert false report "END of SIM" severity note;<br />18         --wait;<br />19     end process _process;<br />20 end u_top;</blockquote><br />非常简单，一个随便赋值了两下的模块。<br /><br />接下来是一个更简单的verilog的dut模块：(top_verilog.sv)<br /><blockquote>1 module top_verilog;<br />2     reg verilog_bit;<br />3     initial begin<br />4         forever begin<br />5             verilog_bit = 1&#039;b0;<br />6             #100<br />7             verilog_bit = ~verilog_bit;<br />8         end<br />9     end<br />10 endmodule</blockquote><br />不停翻转的一个bit。<br /><br />然后是包裹着着两个dut的bench：(top.sv)<br /><blockquote>1 `timescale  1ns/100ps<br />2 module  top_;<br />3    reg  [3:0]   v_bits;<br />4    top_vhdl u_vhdl(<br />5                     .dut_a(v_bits)<br />6                   );<br />7<br />8    top_verilog u_verilog();<br />9<br />10 always @(v_bits) begin<br />11     $display("vhdl&#039;s value is %0x.", v_bits);<br />12 end<br />13 always @(u_verilog.verilog_bit) begin<br />14     $display("verilog&#039;s value is %0b.", u_verilog.verilog_bit);<br />15 end<br />16     demo_pro    u_pro();<br />17 endmodule<br />18<br />19 program demo_pro;<br />20    initial begin<br />21         $display("In first initial:");<br />22         @(top_.u_verilog.verilog_bit);<br />23         $display("hit one toggle!");<br />24         #100<br />25         $finish();<br />26    end<br />27 endprogram</blockquote><br />这里我特意区分开了对verilog和VHDL的dut的信号的引用方式，从这里不难看出，Program中的验证代码部分可以按照hierarchy直接访问到Verilog的模块的内部信号，而对于VHDL的这种情况的访问却只能到port为止，就如同Vera时期的情况类似，信号交互都是发生在Port上，所以这在使用上需要注意。<br /><br />到此为止，一段VHDL的代码已经被正确的import到了SystemVerilog当中，剩下的事情，就和普通的验证流程相仿，无论是要使用OVM/VMM等等，那就同等处理即可，还是相当简单的。<br /><br />而执行以上步骤的命令行如下：<br /><blockquote>ncvhdl top.vhdl;<br />ncvlog top.sv top_verilog.sv;<br />ncelab worklib.top_:module;<br />ncsim worklib.top_:module;</blockquote><br /><h2>小结</h2><br /><!--和-->按照同事的看法，VHDL这种语言必然会死掉，正确与否先不讨论，但是使用起来，针对SV的隔离感还是存在的，希望以后工作中间能够有更多的体会和解决的办法。<br /><p class="scribefire-powered">Powered by <a href="http://www.scribefire.com/">ScribeFire</a>.</p>



<div style="float:right;margin-top:30px;margin-bottom:90px;font-size:12px;">17 Jun 2009 , 写毕。</div>

<!-- Duoshuo Comment BEGIN -->
<div class="ds-thread"></div>
<script type="text/javascript">
var duoshuoQuery = {short_name:"mooninsky"};
	(function() {
	var ds = document.createElement('script');
	ds.type = 'text/javascript';ds.async = true;
	ds.src = 'http://static.duoshuo.com/embed.js';
	ds.charset = 'UTF-8';
	(document.getElementsByTagName('head')[0] 
	|| document.getElementsByTagName('body')[0]).appendChild(ds);
})();
</script>
<!-- Duoshuo Comment END -->
</body>
</html>
